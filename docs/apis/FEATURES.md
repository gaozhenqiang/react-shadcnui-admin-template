# è‚²å®‰æ•™è‚²ç®¡ç†å¹³å° - è¯¦ç»†åŠŸèƒ½è¯´æ˜æ–‡æ¡£

## ğŸ“‘ ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [ç”¨æˆ·è§’è‰²ä½“ç³»](#ç”¨æˆ·è§’è‰²ä½“ç³»)
- [æ ¸å¿ƒåŠŸèƒ½è¯¦è§£](#æ ¸å¿ƒåŠŸèƒ½è¯¦è§£)
- [APIæ¥å£è¯¦ç»†è¯´æ˜](#apiæ¥å£è¯¦ç»†è¯´æ˜)
- [æ•°æ®æµè½¬æµç¨‹](#æ•°æ®æµè½¬æµç¨‹)
- [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                              â”‚
â”‚  ç®¡ç†ç«¯ Web  â”‚  æ•™å¸ˆç«¯ Web  â”‚  å­¦ç”Ÿç«¯ Web/H5  â”‚  å°ç¨‹åº     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                             â”‚
â”‚              NestJS + Express + Swagger                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚
      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡å±‚   â”‚    â”‚   æœåŠ¡å±‚      â”‚
â”‚ Controllerâ”‚â”€â”€â”€â–¶â”‚   Service    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚
              â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MongoDB  â”‚        â”‚  Redis   â”‚
        â”‚  æ•°æ®åº“   â”‚        â”‚   ç¼“å­˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ é˜¿é‡Œäº‘OSS  â”‚  é˜¿é‡Œäº‘çŸ­ä¿¡   â”‚
        â”‚ æ”¯ä»˜å®æ”¯ä»˜  â”‚  å¾®ä¿¡æ”¯ä»˜     â”‚
        â”‚ é˜¿é‡Œäº‘å®åè®¤è¯              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
AppModule
â”œâ”€â”€ AdminModule (ç®¡ç†ç«¯)
â”‚   â”œâ”€â”€ EnrollModule
â”‚   â”œâ”€â”€ CourseModule
â”‚   â”œâ”€â”€ QuestionBankModule
â”‚   â”œâ”€â”€ ExamModule
â”‚   â”œâ”€â”€ OrderModule
â”‚   â”œâ”€â”€ CertificateModule
â”‚   â””â”€â”€ LogisticsModule
â”œâ”€â”€ TeacherModule (æ•™å¸ˆç«¯)
â”‚   â”œâ”€â”€ MicroCourseModule
â”‚   â””â”€â”€ ReviewModule
â”œâ”€â”€ StudentModule (å­¦ç”Ÿç«¯)
â”‚   â”œâ”€â”€ CourseModule
â”‚   â”œâ”€â”€ EnrollModule
â”‚   â””â”€â”€ ExamModule
â””â”€â”€ SharedModules (å…±äº«æ¨¡å—)
    â”œâ”€â”€ AuthModule
    â”œâ”€â”€ UserModule
    â”œâ”€â”€ SmsCodeModule
    â”œâ”€â”€ PaymentModule
    â”œâ”€â”€ AliOssModule
    â”œâ”€â”€ AliSmsModule
    â”œâ”€â”€ AliCloudAuthModule
    â”œâ”€â”€ AliPayModule
    â””â”€â”€ WechatPayModule
```

---

## ğŸ‘¥ ç”¨æˆ·è§’è‰²ä½“ç³»

### è§’è‰²å®šä¹‰

```typescript
enum UserRole {
  ADMIN = 'admin',      // ç³»ç»Ÿç®¡ç†å‘˜
  TEACHER = 'teacher',  // æ•™å¸ˆ
  STUDENT = 'student',  // å­¦ç”Ÿ
}
```

### è§’è‰²æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | ç®¡ç†å‘˜ | æ•™å¸ˆ | å­¦ç”Ÿ |
|---------|--------|------|------|
| ç”¨æˆ·ç®¡ç† | âœ… | âŒ | âŒ |
| æŠ¥è€ƒé¡¹ç›®ç®¡ç† | âœ… | âŒ | âŒ |
| æŠ¥è€ƒç”³è¯·å®¡æ ¸ | âœ… | âŒ | âŒ |
| è¯¾ç¨‹åˆ›å»º/ç¼–è¾‘ | âœ… | âŒ | âŒ |
| é¢˜åº“ç®¡ç† | âœ… | âŒ | âŒ |
| è€ƒè¯•é…ç½® | âœ… | âŒ | âŒ |
| è®¢å•ç®¡ç† | âœ… | âŒ | âŒ |
| è¯ä¹¦ç®¡ç† | âœ… | âŒ | âŒ |
| ç‰©æµç®¡ç† | âœ… | âŒ | âŒ |
| å¾®è¯¾å ‚å‘å¸ƒ | âŒ | âœ… | âŒ |
| ä¸»è§‚é¢˜è¯„åˆ† | âŒ | âœ… | âŒ |
| è®ºæ–‡è¯„å®¡ | âŒ | âœ… | âŒ |
| æŠ¥åç”³è¯· | âŒ | âŒ | âœ… |
| è¯¾ç¨‹å­¦ä¹  | âŒ | âŒ | âœ… |
| å‚åŠ è€ƒè¯• | âŒ | âŒ | âœ… |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. è¯¾ç¨‹å­¦ä¹ ç³»ç»Ÿ

#### 1.1 è¯¾ç¨‹ç±»å‹

**å…è´¹è¯¾ç¨‹**
- æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ç›´æ¥è®¿é—®
- æŸ¥çœ‹å®Œæ•´çš„ç« èŠ‚å†…å®¹
- è§‚çœ‹è§†é¢‘æˆ–ä¸‹è½½PDF
- ä¸éœ€è¦æ”¯ä»˜

**æ”¶è´¹è¯¾ç¨‹**
- éœ€è¦è´­ä¹°åæ‰èƒ½è®¿é—®
- æœªè´­ä¹°æ—¶ï¼š
  - å¯ä»¥çœ‹åˆ°è¯¾ç¨‹ä¿¡æ¯
  - å¯ä»¥çœ‹åˆ°ç« èŠ‚æ ‡é¢˜å’Œæè¿°
  - æ— æ³•çœ‹åˆ°è§†é¢‘/PDFé“¾æ¥
  - æ˜¾ç¤º"è¯·è´­ä¹°åæŸ¥çœ‹"æç¤º
- è´­ä¹°åï¼š
  - å®Œæ•´è®¿é—®æ‰€æœ‰ç« èŠ‚å†…å®¹
  - è§‚çœ‹è§†é¢‘ã€ä¸‹è½½PDF
  - è®°å½•å­¦ä¹ è¿›åº¦

#### 1.2 ç« èŠ‚ç®¡ç†

æ¯ä¸ªç« èŠ‚æ”¯æŒï¼š
- **æ ‡é¢˜** - ç« èŠ‚åç§°
- **æ’åº** - æ˜¾ç¤ºé¡ºåº
- **å†…å®¹ç±»å‹** - videoï¼ˆè§†é¢‘ï¼‰ã€pdfï¼ˆPDFï¼‰ã€pptï¼ˆPPTï¼‰
- **åª’ä½“åœ°å€** - OSSå­˜å‚¨çš„æ–‡ä»¶é“¾æ¥
- **è§†é¢‘é“¾æ¥** - ä¸“é—¨çš„è§†é¢‘åœ°å€å­—æ®µ
- **PDFé“¾æ¥** - ä¸“é—¨çš„PDFåœ°å€å­—æ®µ
- **ç« èŠ‚ä»‹ç»** - ç®€çŸ­æè¿°
- **è¯¦ç»†å†…å®¹** - å®Œæ•´çš„æ–‡æœ¬å†…å®¹
- **æ—¶é•¿** - è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
- **çŠ¶æ€** - activeï¼ˆæ¿€æ´»ï¼‰ã€inactiveï¼ˆç¦ç”¨ï¼‰

#### 1.3 å­¦ä¹ è®°å½•

ç³»ç»Ÿè‡ªåŠ¨è®°å½•ï¼š
- å­¦ä¹ è¿›åº¦ç™¾åˆ†æ¯”
- æœ€åè§‚çœ‹ä½ç½®
- æ˜¯å¦å®Œæˆ
- ä¹¦ç­¾è®°å½•ï¼ˆé‡è¦çŸ¥è¯†ç‚¹æ ‡è®°ï¼‰
- å­¦ä¹ æ—¶é•¿ç»Ÿè®¡

#### 1.4 è®¿é—®æ§åˆ¶å®ç°

```typescript
// æ£€æŸ¥è¯¾ç¨‹è®¿é—®æƒé™
async checkCourseAccess(userId: string, courseId: string) {
  const course = await courseModel.findById(courseId)
  
  // å…è´¹è¯¾ç¨‹ç›´æ¥å…è®¸
  if (course.isFree) {
    return true
  }
  
  // æ£€æŸ¥è´­ä¹°è®°å½•
  const purchase = await coursePurchaseModel.findOne({
    userId,
    courseId,
    status: 'active'
  })
  
  return !!purchase
}

// è·å–ç« èŠ‚æ—¶çš„æƒé™è¿‡æ»¤
async getLessonWithAccess(lessonId: string, userId: string) {
  const lesson = await lessonModel.findById(lessonId)
  const hasAccess = await checkCourseAccess(userId, lesson.courseId)
  
  if (!hasAccess) {
    // éšè—æ•æ„Ÿä¿¡æ¯
    return {
      ...lesson,
      mediaUrl: null,
      videoUrl: null,
      pdfUrl: null,
      canAccess: false,
      message: 'è¯¥è¯¾ç¨‹ä¸ºæ”¶è´¹è¯¾ç¨‹ï¼Œè¯·è´­ä¹°åæŸ¥çœ‹'
    }
  }
  
  return { ...lesson, canAccess: true }
}
```

---

### 2. æŠ¥è€ƒç®¡ç†ç³»ç»Ÿ

> **æ ¸å¿ƒå˜æ›´**ï¼šæŠ¥è€ƒåŸºäº"çº§åˆ«-è¯¾ç¨‹"ä½“ç³»ï¼Œè¯¦ç»†è¯´æ˜è§ [BUSINESS_LOGIC.md](./BUSINESS_LOGIC.md)

#### 2.1 æŠ¥è€ƒé¡¹ç›®ç»“æ„

ç®¡ç†å‘˜åˆ›å»ºæŠ¥è€ƒé¡¹ç›®æ—¶ï¼Œéœ€è¦é…ç½®ï¼š

**é¡¹ç›®åŸºæœ¬ä¿¡æ¯**ï¼š
- **é¡¹ç›®åç§°** - å¦‚"é£é™©ç®¡ç†å¸ˆèŒä¸šèµ„æ ¼è®¤è¯"
- **é¡¹ç›®æè¿°** - é¡¹ç›®ä»‹ç»
- **æŠ¥åè¦æ±‚** - å­¦å†ã€å·¥ä½œç»éªŒç­‰
- **æŠ¥åæ—¶é—´** - å¼€å§‹å’Œæˆªæ­¢æ—¶é—´
- **çŠ¶æ€** - æ‹›ç”Ÿä¸­/å·²ç»“æŸ

**çº§åˆ«é…ç½®**ï¼ˆä¸€å¯¹å¤šï¼‰ï¼š
```json
{
  "levelId": "level_3",
  "levelName": "ä¸‰çº§",
  "price": 2980,                    // æŠ¥è€ƒè´¹ï¼ˆä¸å«è¯¾ç¨‹è´¹ï¼‰
  "requirements": "å¤§ä¸“åŠä»¥ä¸Šå­¦å†",
  "description": "é€‚åˆåˆå­¦è€…",
  "courses": [                      // è¯¥çº§åˆ«åŒ…å«çš„è¯¾ç¨‹
    {
      "courseId": "course_001",
      "courseName": "é£é™©ç®¡ç†åŸºç¡€ç†è®º",
      "coursePrice": 299,
      "order": 1,
      "required": true
    },
    {
      "courseId": "course_002",
      "courseName": "é£é™©è¯†åˆ«ä¸è¯„ä¼°",
      "coursePrice": 399,
      "order": 2,
      "required": true
    },
    {
      "courseId": "course_003",
      "courseName": "é£é™©æ§åˆ¶æ–¹æ³•",
      "coursePrice": 399,
      "order": 3,
      "required": true
    }
  ]
}
```

**é‡è¦**ï¼š
- æŠ¥è€ƒè´¹ï¼ˆå¦‚2980å…ƒï¼‰â‰  è¯¾ç¨‹è´¹ï¼ˆéœ€å¦ä»˜ï¼‰
- å­¦ç”ŸæŠ¥è€ƒåéœ€è¦å•ç‹¬è´­ä¹°æ¯é—¨è¯¾ç¨‹
- æ€»è´¹ç”¨ = æŠ¥è€ƒè´¹ + æ‰€æœ‰è¯¾ç¨‹è´¹ï¼ˆ2980 + 299 + 399 + 399 = 4077å…ƒï¼‰

#### 2.2 ç”³è¯·æµç¨‹

**å­¦ç”Ÿç«¯æµç¨‹**ï¼š
1. æµè§ˆå¯æŠ¥è€ƒçš„é¡¹ç›®
2. é€‰æ‹©çº§åˆ«ï¼ˆå¦‚"ä¸‰çº§"ï¼‰
3. æŸ¥çœ‹è¯¥çº§åˆ«åŒ…å«çš„è¯¾ç¨‹åˆ—è¡¨å’Œæ€»è´¹ç”¨
4. å¡«å†™ä¸ªäººä¿¡æ¯
5. ä¸Šä¼ è¯æ˜ææ–™ï¼ˆå­¦å†è¯æ˜ã€å·¥ä½œè¯æ˜ç­‰ï¼‰
6. æäº¤ç”³è¯·
7. ç­‰å¾…å®¡æ ¸

**ç®¡ç†ç«¯æµç¨‹**ï¼š
1. æŸ¥çœ‹å¾…å®¡æ ¸ç”³è¯·åˆ—è¡¨
2. æŸ¥çœ‹ç”³è¯·äººè¯¦ç»†èµ„æ–™å’Œè¯æ˜ææ–™
3. å®¡æ ¸ç”³è¯·ï¼ˆé€šè¿‡/æ‹’ç»ï¼‰
4. å®¡æ ¸é€šè¿‡åç³»ç»Ÿè‡ªåŠ¨ï¼š
   - è®¾ç½® `approvedAt = å½“å‰æ—¶é—´`
   - è®¾ç½® `expiresAt = å½“å‰æ—¶é—´ + 2å¹´`
   - åˆ›å»ºæŠ¥è€ƒè´¹è®¢å•
5. å­¦ç”Ÿæ”¯ä»˜æŠ¥è€ƒè´¹
6. æ”¯ä»˜æˆåŠŸåæŠ¥è€ƒæ­£å¼ç”Ÿæ•ˆï¼ˆå¼€å§‹2å¹´å€’è®¡æ—¶ï¼‰

**2å¹´æœ‰æ•ˆæœŸ**ï¼š
- ä»å®¡æ ¸é€šè¿‡æ—¶å¼€å§‹è®¡ç®—
- 2å¹´å†…å¿…é¡»å®Œæˆæ‰€æœ‰è¯¾ç¨‹è€ƒè¯•å¹¶å–å¾—è¯ä¹¦
- è¶…è¿‡2å¹´æœªå–è¯ï¼ŒæŠ¥è€ƒè‡ªåŠ¨å¤±æ•ˆ
- å¤±æ•ˆåæ‰€æœ‰è¯¾ç¨‹è´­ä¹°è®°å½•å’Œè€ƒè¯•æˆç»©ä½œåºŸ
- éœ€è¦é‡æ–°æŠ¥è€ƒ

#### 2.3 æŠ¥è€ƒè¿›åº¦ç®¡ç†

æŠ¥è€ƒç”³è¯·åŒ…å«è¯¦ç»†çš„è¿›åº¦ä¿¡æ¯ï¼š

```typescript
{
  // åŸºæœ¬ä¿¡æ¯
  levelName: "ä¸‰çº§",
  status: "active",              // active | expired | completed
  
  // æœ‰æ•ˆæœŸ
  approvedAt: Date,              // 2023-06-15
  expiresAt: Date,               // 2025-06-15ï¼ˆ2å¹´åï¼‰
  isExpired: false,
  daysRemaining: 365,            // å‰©ä½™å¤©æ•°
  
  // è€ƒè¯•è¿›åº¦
  examProgress: {
    totalCourses: 3,             // è¯¥çº§åˆ«æ€»è¯¾ç¨‹æ•°
    passedCourses: 1,            // å·²é€šè¿‡è¯¾ç¨‹æ•°
    courseStatus: [
      {
        courseId: ObjectId,
        courseName: "é£é™©ç®¡ç†åŸºç¡€ç†è®º",
        purchased: true,         // æ˜¯å¦å·²è´­ä¹°
        examPassed: true,        // è€ƒè¯•æ˜¯å¦é€šè¿‡
        remainingAttempts: 0,    // å‰©ä½™è€ƒè¯•æ¬¡æ•°
        lastExamAt: Date         // æœ€åè€ƒè¯•æ—¶é—´
      },
      {
        courseId: ObjectId,
        courseName: "é£é™©è¯†åˆ«ä¸è¯„ä¼°",
        purchased: true,
        examPassed: false,
        remainingAttempts: 1,    // è¿˜å¯ä»¥è¡¥è€ƒ1æ¬¡
      },
      {
        courseId: ObjectId,
        courseName: "é£é™©æ§åˆ¶æ–¹æ³•",
        purchased: false,        // è¿˜æœªè´­ä¹°
        examPassed: false,
        remainingAttempts: 2,
      }
    ]
  },
  
  // è¯ä¹¦èµ„æ ¼
  eligibleForCertificate: false, // æ˜¯å¦æ»¡è¶³è¯ä¹¦ç”³è¯·æ¡ä»¶
  certificateId: null,           // è¯ä¹¦IDï¼ˆå·²ç”Ÿæˆæ—¶ï¼‰
}
```

#### 2.4 æ•°æ®å¿«ç…§

ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œç”³è¯·æäº¤æ—¶ä¼šä¿å­˜å¿«ç…§ï¼š
```typescript
{
  personalInfo: {                // ä¸ªäººä¿¡æ¯å¿«ç…§
    name: "å¼ ä¸‰",
    idCard: "110***********1234",
    education: "æœ¬ç§‘",
    // ... å…¶ä»–ä¿¡æ¯
  },
  proofFiles: [                  // è¯æ˜ææ–™å¿«ç…§
    { type: "å­¦å†è¯æ˜", url: "..." },
    { type: "å·¥ä½œè¯æ˜", url: "..." }
  ],
  projectSnapshot: {             // é¡¹ç›®ä¿¡æ¯å¿«ç…§ï¼ˆé˜²æ­¢é¡¹ç›®ä¿®æ”¹åå½±å“å·²æŠ¥è€ƒå­¦ç”Ÿï¼‰
    projectName: "é£é™©ç®¡ç†å¸ˆèŒä¸šèµ„æ ¼è®¤è¯",
    levelName: "ä¸‰çº§",
    levelPrice: 2980,
    courses: [...]               // è¯¾ç¨‹åˆ—è¡¨å¿«ç…§
  }
}
```

#### 2.5 è¿‡æœŸå¤„ç†

ç³»ç»Ÿæ¯å¤©å®šæ—¶æ£€æŸ¥è¿‡æœŸæŠ¥è€ƒï¼š

```typescript
// å®šæ—¶ä»»åŠ¡
async checkExpiredApplications() {
  const now = new Date()
  
  // æŸ¥æ‰¾å·²è¿‡æœŸä½†æœªæ ‡è®°çš„æŠ¥è€ƒ
  const expiredApps = await enrollApplicationModel.find({
    expiresAt: { $lt: now },
    isExpired: false,
    eligibleForCertificate: false  // æœªå–è¯
  })
  
  for (const app of expiredApps) {
    // 1. æ ‡è®°æŠ¥è€ƒä¸ºè¿‡æœŸ
    app.status = 'expired'
    app.isExpired = true
    await app.save()
    
    // 2. å°†æ‰€æœ‰è¯¾ç¨‹è´­ä¹°è®°å½•æ ‡è®°ä¸ºå¤±æ•ˆ
    await coursePurchaseModel.updateMany(
      { enrollApplicationId: app._id },
      { status: 'expired' }
    )
    
    // 3. å‘é€é€šçŸ¥
    await notificationService.send(app.userId, {
      type: 'enroll_expired',
      title: 'æŠ¥è€ƒå·²è¿‡æœŸ',
      message: 'æ‚¨çš„æŠ¥è€ƒå·²è¶…è¿‡2å¹´æœ‰æ•ˆæœŸï¼Œæˆç»©å’Œè¯¾ç¨‹æƒé™å·²å¤±æ•ˆï¼Œå¦‚éœ€ç»§ç»­å­¦ä¹ è¯·é‡æ–°æŠ¥è€ƒã€‚'
    })
  }
}
```

---

### 3. é¢˜åº“è€ƒè¯•ç³»ç»Ÿ

> **é‡è¦**ï¼šè€ƒè¯•ç³»ç»ŸåŸºäº"æŠ¥è€ƒ-çº§åˆ«-è¯¾ç¨‹"ä½“ç³»ï¼Œè¯¦ç»†ä¸šåŠ¡é€»è¾‘è¯·å‚è€ƒ [BUSINESS_LOGIC.md](./BUSINESS_LOGIC.md)

#### 3.1 æ ¸å¿ƒæ¦‚å¿µ

**æŠ¥è€ƒä½“ç³»**ï¼š
```
æŠ¥è€ƒé¡¹ç›®
â””â”€â”€ çº§åˆ«ï¼ˆå¦‚ï¼šä¸‰çº§ï¼‰
    â”œâ”€â”€ è¯¾ç¨‹1ï¼ˆæœ‰ç‹¬ç«‹è€ƒè¯•ï¼‰
    â”œâ”€â”€ è¯¾ç¨‹2ï¼ˆæœ‰ç‹¬ç«‹è€ƒè¯•ï¼‰
    â””â”€â”€ è¯¾ç¨‹3ï¼ˆæœ‰ç‹¬ç«‹è€ƒè¯•ï¼‰

è¯ä¹¦ç”³è¯·æ¡ä»¶ï¼šè¯¥çº§åˆ«æ‰€æœ‰è¯¾ç¨‹è€ƒè¯•éƒ½é€šè¿‡
```

**å…³é”®è§„åˆ™**ï¼š
1. **æŠ¥è€ƒæœ‰æ•ˆæœŸ**ï¼š2å¹´ï¼ˆä»å®¡æ ¸é€šè¿‡å¼€å§‹ï¼‰
2. **è€ƒè¯•æ¬¡æ•°**ï¼šæ¯é—¨è¯¾ç¨‹å¯å…è´¹è€ƒ2æ¬¡ï¼ˆé¦–è€ƒ+1æ¬¡è¡¥è€ƒï¼‰
3. **é‡æ–°è´­ä¹°**ï¼š2æ¬¡éƒ½æœªé€šè¿‡éœ€é‡æ–°è´­ä¹°è¯¥è¯¾ç¨‹
4. **è¿‡æœŸå¤±æ•ˆ**ï¼š2å¹´å†…æœªå–è¯ï¼ŒæŠ¥è€ƒå¤±æ•ˆï¼Œéœ€é‡æ–°æŠ¥è€ƒ

#### 3.2 é¢˜åº“ç®¡ç†

**é¢˜åº“ç»“æ„**ï¼š
```
é¢˜åº“ (QuestionBank)
â””â”€â”€ é¢˜ç›® (Question)
    â”œâ”€â”€ é€‰æ‹©é¢˜ (single_choice, multiple_choice)
    â”œâ”€â”€ åˆ¤æ–­é¢˜ (true_false)
    â”œâ”€â”€ å¡«ç©ºé¢˜ (fill_blank)
    â”œâ”€â”€ ç®€ç­”é¢˜ (short_answer)
    â””â”€â”€ è®ºæ–‡é¢˜ (essay)
```

**é¢˜ç›®å­—æ®µ**ï¼š
```typescript
{
  type: string           // é¢˜å‹
  content: string        // é¢˜ç›®å†…å®¹
  options: Array         // é€‰é¡¹ï¼ˆé€‰æ‹©é¢˜ï¼‰
  answer: any           // æ­£ç¡®ç­”æ¡ˆ
  analysis: string      // ç­”æ¡ˆè§£æ
  score: number         // åˆ†å€¼
  difficulty: number    // éš¾åº¦ç³»æ•° 1-5
  tags: Array           // æ ‡ç­¾
  status: string        // çŠ¶æ€
}
```

#### 3.3 è€ƒè¯•é…ç½®

æ¯é—¨è¯¾ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„è€ƒè¯•é…ç½®ï¼š
- **è€ƒè¯•åç§°** - "é£é™©ç®¡ç†åŸºç¡€ç†è®ºè€ƒè¯•"
- **å…³è”è¯¾ç¨‹** - ç‰¹å®šè¯¾ç¨‹
- **é¢˜åº“é€‰æ‹©** - ä»å“ªä¸ªé¢˜åº“æŠ½é¢˜
- **é¢˜ç›®é…ç½®** - å„ç±»å‹é¢˜ç›®æ•°é‡å’Œåˆ†å€¼
  ```json
  {
    "single_choice": { count: 20, score: 2 },
    "multiple_choice": { count: 10, score: 3 },
    "true_false": { count: 10, score: 1 },
    "short_answer": { count: 5, score: 10 }
  }
  ```
- **è€ƒè¯•æ—¶é•¿** - åˆ†é’Ÿæ•°
- **åŠæ ¼åˆ†æ•°** - 60åˆ†æˆ–å…¶ä»–

#### 3.4 å®Œæ•´è€ƒè¯•æµç¨‹

**1. æŠ¥è€ƒé˜¶æ®µ**
```
å­¦ç”Ÿæäº¤æŠ¥è€ƒç”³è¯·ï¼ˆé€‰æ‹©çº§åˆ«ï¼‰ â†’ ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ 
â†’ å­¦ç”Ÿæ”¯ä»˜æŠ¥è€ƒè´¹ â†’ æŠ¥è€ƒç”Ÿæ•ˆï¼ˆ2å¹´æœ‰æ•ˆæœŸå¼€å§‹ï¼‰
```

**2. è¯¾ç¨‹è´­ä¹°**
```
æŸ¥çœ‹è¯¥çº§åˆ«çš„è¯¾ç¨‹åˆ—è¡¨ â†’ é€‰æ‹©è¯¾ç¨‹è´­ä¹°ï¼ˆæ¯é—¨å•ç‹¬ä»˜è´¹ï¼‰ 
â†’ è·å¾—å­¦ä¹ æƒé™ + 2æ¬¡è€ƒè¯•æœºä¼š
```

**3. å¼€å§‹è€ƒè¯•å‰æ£€æŸ¥**
```typescript
// æ£€æŸ¥æ˜¯å¦å¯ä»¥è€ƒè¯•
æ£€æŸ¥æŠ¥è€ƒæ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†… âœ“
æ£€æŸ¥è¯¾ç¨‹æ˜¯å¦å·²è´­ä¹° âœ“
æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å‰©ä½™è€ƒè¯•æ¬¡æ•°ï¼ˆremainingAttempts > 0ï¼‰âœ“
æ£€æŸ¥è¯¥è¯¾ç¨‹è€ƒè¯•æ˜¯å¦å·²é€šè¿‡ âœ“
```

**4. å¼€å§‹è€ƒè¯•**
```
å­¦ç”Ÿç‚¹å‡»å¼€å§‹è€ƒè¯• â†’ æ‰£é™¤1æ¬¡è€ƒè¯•æœºä¼š â†’ ç”Ÿæˆè¯•å· 
â†’ åˆ›å»ºè€ƒè¯•ä¼šè¯ â†’ è¿”å›è¯•é¢˜ï¼ˆä¸å«ç­”æ¡ˆï¼‰
```

**5. ç­”é¢˜è¿‡ç¨‹**
```
å­¦ç”Ÿç­”é¢˜ â†’ å®æ—¶ä¿å­˜ç­”æ¡ˆ â†’ æ£€æŸ¥æ—¶é—´æ˜¯å¦è¶…æ—¶ 
â†’ å…è®¸æš‚å­˜è‰ç¨¿ â†’ æœ€ç»ˆæäº¤
```

**6. è‡ªåŠ¨æ‰¹æ”¹**
```
æäº¤ç­”æ¡ˆ â†’ æ‰¹æ”¹å®¢è§‚é¢˜ï¼ˆé€‰æ‹©ã€åˆ¤æ–­ã€å¡«ç©ºï¼‰ 
â†’ è®¡ç®—å®¢è§‚é¢˜å¾—åˆ† â†’ ç”Ÿæˆä¸»è§‚é¢˜è¯„åˆ†ä»»åŠ¡ï¼ˆå¦‚æœ‰ï¼‰
```

**7. æ•™å¸ˆè¯„åˆ†**ï¼ˆå¦‚æœ‰ä¸»è§‚é¢˜ï¼‰
```
æ•™å¸ˆæ¥æ”¶è¯„åˆ†ä»»åŠ¡ â†’ æŸ¥çœ‹å­¦ç”Ÿç­”æ¡ˆ â†’ ç»™åˆ†å¹¶å†™è¯„è¯­ 
â†’ æäº¤è¯„åˆ† â†’ æ›´æ–°æ€»åˆ†
```

**8. è€ƒè¯•ç»“æœå¤„ç†**
```
è®¡ç®—æ€»åˆ† â†’ åˆ¤å®šæ˜¯å¦é€šè¿‡
    â†“
    â”œâ”€â†’ é€šè¿‡ â†’ æ›´æ–°è¯¾ç¨‹è´­ä¹°è®°å½•ï¼ˆexamPassed = trueï¼‰
    â”‚        â†’ æ›´æ–°æŠ¥è€ƒè¿›åº¦ï¼ˆpassedCourses +1ï¼‰
    â”‚        â†’ æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è¯¾ç¨‹éƒ½é€šè¿‡
    â”‚               â†“
    â”‚               â””â”€â†’ æ˜¯ â†’ æ»¡è¶³è¯ä¹¦ç”³è¯·èµ„æ ¼ â†’ è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ âœ“
    â”‚
    â””â”€â†’ æœªé€šè¿‡ â†’ æ£€æŸ¥å‰©ä½™è€ƒè¯•æ¬¡æ•°
                    â†“
                    â”œâ”€â†’ è¿˜æœ‰æ¬¡æ•° â†’ å¯ä»¥è¡¥è€ƒ
                    â””â”€â†’ æ¬¡æ•°ç”¨å®Œ â†’ éœ€è¦é‡æ–°è´­ä¹°è¯¥è¯¾ç¨‹
```

**9. é‡æ–°è´­ä¹°æµç¨‹**ï¼ˆå¦‚éœ€è¦ï¼‰
```
2æ¬¡è€ƒè¯•éƒ½æœªé€šè¿‡ â†’ remainingAttempts = 0 
â†’ å­¦ç”Ÿé‡æ–°è´­ä¹°è¯¥è¯¾ç¨‹ â†’ åˆ›å»ºæ–°çš„è´­ä¹°è®°å½• 
â†’ é‡æ–°è·å¾—2æ¬¡è€ƒè¯•æœºä¼š â†’ ç»§ç»­å­¦ä¹ å’Œè€ƒè¯•
```

**10. è¯ä¹¦ç”Ÿæˆ**
```
æ£€æŸ¥è¯¥çº§åˆ«æ‰€æœ‰è¯¾ç¨‹æ˜¯å¦éƒ½é€šè¿‡ âœ“
æ£€æŸ¥æŠ¥è€ƒæ˜¯å¦åœ¨2å¹´æœ‰æ•ˆæœŸå†… âœ“
    â†“
æ»¡è¶³æ¡ä»¶ â†’ è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ â†’ å­¦ç”Ÿå¯ç”³è¯·çº¸è´¨è¯ä¹¦é‚®å¯„
```

#### 3.5 è€ƒè¯•çŠ¶æ€ç®¡ç†

**è¯¾ç¨‹è´­ä¹°è®°å½•ï¼ˆCoursePurchaseï¼‰**ï¼š
```typescript
{
  totalAttempts: 2,          // æ€»è€ƒè¯•æ¬¡æ•°
  usedAttempts: 0,           // å·²ä½¿ç”¨æ¬¡æ•°
  remainingAttempts: 2,      // å‰©ä½™æ¬¡æ•°
  examPassed: false,         // æ˜¯å¦é€šè¿‡
  status: 'active'           // active | expired
}
```

**è€ƒè¯•ä¼šè¯ï¼ˆExamSessionï¼‰**ï¼š
```typescript
{
  attemptNumber: 1,          // ç¬¬å‡ æ¬¡è€ƒè¯•ï¼ˆ1æˆ–2ï¼‰
  isRetake: false,           // æ˜¯å¦ä¸ºè¡¥è€ƒ
  passed: false,             // æ˜¯å¦é€šè¿‡
  obtainedScore: 0,          // è·å¾—åˆ†æ•°
}
```

#### 3.4 æ™ºèƒ½ç»„å·ç®—æ³•

```typescript
// æŒ‰é¢˜å‹å’Œéš¾åº¦åˆ†å¸ƒæŠ½é¢˜
async generateExamPaper(configId: string) {
  const config = await getExamConfig(configId)
  const questions = []
  
  for (const [type, rule] of Object.entries(config.questionConfig)) {
    // æŒ‰éš¾åº¦åˆ†å±‚æŠ½é¢˜
    const easyCount = Math.floor(rule.count * 0.3)
    const mediumCount = Math.floor(rule.count * 0.5)
    const hardCount = rule.count - easyCount - mediumCount
    
    // ä»é¢˜åº“éšæœºæŠ½å–
    questions.push(
      ...await getRandomQuestions(bankId, type, 1, easyCount),
      ...await getRandomQuestions(bankId, type, 3, mediumCount),
      ...await getRandomQuestions(bankId, type, 5, hardCount)
    )
  }
  
  return shuffle(questions) // æ‰“ä¹±é¡ºåº
}
```

---

### 4. è®¢å•æ”¯ä»˜ç³»ç»Ÿ

#### 4.1 è®¢å•ç±»å‹

| è®¢å•ç±»å‹ | è¯´æ˜ | å…³è”ä¸šåŠ¡ |
|---------|------|---------|
| `enroll` | æŠ¥è€ƒç¼´è´¹ | æŠ¥è€ƒç”³è¯· |
| `course` | è¯¾ç¨‹è´­ä¹° | æ”¶è´¹è¯¾ç¨‹ |
| `micro_course` | å¾®è¯¾å ‚è´­ä¹° | å¾®è¯¾å ‚ |
| `certificate` | è¯ä¹¦è´¹ç”¨ | çº¸è´¨è¯ä¹¦é‚®å¯„ |

#### 4.2 è®¢å•çŠ¶æ€æµè½¬

```
pending (å¾…æ”¯ä»˜)
    â”‚
    â”œâ”€â†’ paid (å·²æ”¯ä»˜) â”€â”€â†’ completed (å·²å®Œæˆ)
    â”‚
    â”œâ”€â†’ cancelled (å·²å–æ¶ˆ)
    â”‚
    â””â”€â†’ refunded (å·²é€€æ¬¾)
```

#### 4.3 æ”¯ä»˜æµç¨‹

**æ”¯ä»˜å®æ”¯ä»˜**ï¼š
```
1. åˆ›å»ºè®¢å• â†’ 2. è°ƒç”¨æ”¯ä»˜å®SDKç”Ÿæˆæ”¯ä»˜é“¾æ¥ 
â†’ 3. ç”¨æˆ·æ‰«ç æ”¯ä»˜ â†’ 4. æ”¯ä»˜å®å¼‚æ­¥å›è°ƒ 
â†’ 5. éªŒè¯ç­¾å â†’ 6. æ›´æ–°è®¢å•çŠ¶æ€ â†’ 7. å¼€é€šä¸šåŠ¡æƒé™
```

**å¾®ä¿¡æ”¯ä»˜**ï¼š
```
1. åˆ›å»ºè®¢å• â†’ 2. è°ƒç”¨å¾®ä¿¡æ”¯ä»˜API 
â†’ 3. ç”¨æˆ·æ‰«ç æ”¯ä»˜ â†’ 4. å¾®ä¿¡å¼‚æ­¥å›è°ƒ 
â†’ 5. éªŒè¯ç­¾å â†’ 6. æ›´æ–°è®¢å•çŠ¶æ€ â†’ 7. å¼€é€šä¸šåŠ¡æƒé™
```

#### 4.4 ä¸šåŠ¡å¼€é€šé€»è¾‘

```typescript
// æ”¯ä»˜æˆåŠŸåçš„ä¸šåŠ¡å¤„ç†
async handlePaymentSuccess(orderId: string) {
  const order = await orderModel.findById(orderId)
  
  switch (order.type) {
    case 'course':
      // å¼€é€šè¯¾ç¨‹æƒé™
      await coursePurchaseModel.create({
        userId: order.userId,
        courseId: order.relatedId,
        orderId: order._id,
        status: 'active'
      })
      break
      
    case 'enroll':
      // æ›´æ–°æŠ¥è€ƒç”³è¯·çš„æ”¯ä»˜çŠ¶æ€
      await enrollApplicationModel.updateOne(
        { _id: order.relatedId },
        { paymentStatus: 'paid', paymentOrderId: order._id }
      )
      break
      
    case 'certificate':
      // åˆ›å»ºç‰©æµè®°å½•
      await logisticsModel.create({
        certificateId: order.relatedId,
        userId: order.userId,
        status: 'pending'
      })
      break
  }
}
```

---

### 5. è¯ä¹¦ä¸ç‰©æµç³»ç»Ÿ

#### 5.1 è¯ä¹¦ç”Ÿæˆ

**è§¦å‘æ¡ä»¶**ï¼š
- å­¦ç”Ÿé€šè¿‡è€ƒè¯•
- ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»º

**è¯ä¹¦ä¿¡æ¯**ï¼š
```typescript
{
  certificateNo: string    // å”¯ä¸€è¯ä¹¦ç¼–å·ï¼šCERT-2025-001234
  userId: ObjectId         // æŒè¯äºº
  projectId: ObjectId      // å…³è”é¡¹ç›®
  examSessionId: ObjectId  // è€ƒè¯•è®°å½•
  type: string            // è¯ä¹¦ç±»å‹
  name: string            // è¯ä¹¦åç§°
  level: string           // çº§åˆ«
  holderInfo: {
    name: string          // å§“å
    idCard: string        // èº«ä»½è¯å·
    photo: string         // ç…§ç‰‡
  },
  issuedAt: Date          // é¢å‘æ—¥æœŸ
  validUntil: Date        // æœ‰æ•ˆæœŸè‡³
  status: string          // çŠ¶æ€ï¼šactive | revoked
  needPhysical: boolean   // æ˜¯å¦éœ€è¦çº¸è´¨è¯ä¹¦
}
```

#### 5.2 ç‰©æµè¿½è¸ª

**ç‰©æµè®°å½•**ï¼š
```typescript
{
  trackingNo: string      // å¿«é€’å•å·
  certificateId: ObjectId // å…³è”è¯ä¹¦
  userId: ObjectId        // æ”¶ä»¶äºº
  company: string         // å¿«é€’å…¬å¸ï¼šé¡ºä¸°ã€åœ†é€šç­‰
  shippingAddress: {
    receiverName: string
    receiverPhone: string
    province: string
    city: string
    district: string
    address: string
  },
  trackingHistory: [      // ç‰©æµè½¨è¿¹
    {
      time: Date,
      status: string,     // å·²æ½æ”¶ã€è¿è¾“ä¸­ã€æ´¾é€ä¸­ã€å·²ç­¾æ”¶
      description: string,
      location: string
    }
  ],
  status: string          // pending | shipped | delivered
}
```

**æŸ¥è¯¢æ–¹å¼**ï¼š
- é€šè¿‡å¿«é€’å•å·æŸ¥è¯¢
- é€šè¿‡è¯ä¹¦IDæŸ¥è¯¢
- é€šè¿‡ç”¨æˆ·IDæŸ¥è¯¢æ‰€æœ‰ç‰©æµ

---

### 6. æ•™å¸ˆè¯„åˆ†ç³»ç»Ÿ

#### 6.1 ä¸»è§‚é¢˜è¯„åˆ†

**ä»»åŠ¡åˆ†é…**ï¼š
ç³»ç»Ÿè‡ªåŠ¨å°†éœ€è¦äººå·¥è¯„åˆ†çš„ä¸»è§‚é¢˜åˆ†é…ç»™æ•™å¸ˆã€‚

**è¯„åˆ†ä»»åŠ¡**ï¼š
```typescript
{
  examSessionId: ObjectId  // è€ƒè¯•ä¼šè¯
  studentId: ObjectId      // å­¦ç”ŸID
  teacherId: ObjectId      // è¯„åˆ†æ•™å¸ˆ
  questionId: ObjectId     // é¢˜ç›®ID
  studentAnswer: any       // å­¦ç”Ÿç­”æ¡ˆ
  score: number           // ç»™åˆ†
  feedback: string        // è¯„è¯­
  status: string          // pending | completed
}
```

**è¯„åˆ†æµç¨‹**ï¼š
```
æ•™å¸ˆç™»å½• â†’ æŸ¥çœ‹å¾…è¯„åˆ†ä»»åŠ¡ â†’ æŸ¥çœ‹å­¦ç”Ÿç­”æ¡ˆ 
â†’ å‚è€ƒæ ‡å‡†ç­”æ¡ˆå’Œè¯„åˆ†æ ‡å‡† â†’ ç»™åˆ†å¹¶å†™è¯„è¯­ â†’ æäº¤è¯„åˆ†
```

#### 6.2 è®ºæ–‡è¯„å®¡

**è¯„å®¡ä»»åŠ¡**ï¼š
```typescript
{
  studentId: ObjectId      // å­¦ç”ŸID
  teacherId: ObjectId      // è¯„å®¡æ•™å¸ˆ
  projectId: ObjectId      // å…³è”é¡¹ç›®
  thesisTitle: string      // è®ºæ–‡æ ‡é¢˜
  thesisContent: string    // è®ºæ–‡å†…å®¹
  thesisFiles: Array       // é™„ä»¶
  score: number           // è¯„åˆ†
  feedback: string        // è¯„å®¡æ„è§
  status: string          // pending | completed | rejected
  submittedAt: Date       // æäº¤æ—¶é—´
  reviewedAt: Date        // è¯„å®¡æ—¶é—´
}
```

---

### 7. å¾®è¯¾å ‚ç³»ç»Ÿ

#### 7.1 å¾®è¯¾å ‚ç‰¹æ€§

æ•™å¸ˆå¯ä»¥å‘å¸ƒçŸ­è§†é¢‘è¯¾ç¨‹ï¼š
- **ç±»å‹** - çŸ¥è¯†ç‚¹è®²è§£ã€ç»éªŒåˆ†äº«ã€æ¡ˆä¾‹åˆ†æ
- **æ—¶é•¿** - é€šå¸¸ 5-30 åˆ†é’Ÿ
- **å®šä»·** - æ•™å¸ˆè‡ªä¸»å®šä»·
- **çŠ¶æ€** - draftï¼ˆè‰ç¨¿ï¼‰ã€publishedï¼ˆå·²å‘å¸ƒï¼‰ã€offlineï¼ˆå·²ä¸‹çº¿ï¼‰

#### 7.2 ç»Ÿè®¡æ•°æ®

æ•™å¸ˆå¯ä»¥æŸ¥çœ‹ï¼š
- **æµè§ˆé‡** - å¤šå°‘äººæŸ¥çœ‹
- **è´­ä¹°é‡** - å¤šå°‘äººè´­ä¹°
- **æ”¶å…¥ç»Ÿè®¡** - æŒ‰æœˆç»Ÿè®¡æ”¶å…¥
- **å­¦ç”Ÿåé¦ˆ** - è¯„ä»·å’Œè¯„è®º

**æœˆåº¦ç»Ÿè®¡æ•°æ®ç»“æ„**ï¼š
```typescript
{
  teacherId: ObjectId
  microCourseId: ObjectId
  year: number
  month: number
  viewCount: number        // æµè§ˆæ¬¡æ•°
  purchaseCount: number    // è´­ä¹°æ¬¡æ•°
  revenue: number          // æ”¶å…¥é‡‘é¢
  avgRating: number        // å¹³å‡è¯„åˆ†
}
```

---

### 8. çŸ­ä¿¡éªŒè¯ç ç³»ç»Ÿ

#### 8.1 éªŒè¯ç ç±»å‹

- `register` - æ³¨å†Œ
- `login` - ç™»å½•
- `reset_password` - é‡ç½®å¯†ç 
- `change_phone` - ä¿®æ”¹æ‰‹æœºå·

#### 8.2 é˜²åˆ·æœºåˆ¶

**é¢‘ç‡é™åˆ¶**ï¼š
```typescript
// åŒä¸€æ‰‹æœºå·60ç§’å†…åªèƒ½å‘é€ä¸€æ¬¡
const lastCode = await smsCodeModel.findOne({
  phone,
  createdAt: { $gte: Date.now() - 60000 }
})
if (lastCode) {
  throw new AppException(
    ExceptionCode.SMSSendFailed,
    'è¯·å‹¿é¢‘ç¹å‘é€éªŒè¯ç ï¼Œè¯·60ç§’åå†è¯•'
  )
}

// åŒä¸€IPæ¯å¤©æœ€å¤š10æ¬¡
const todayCount = await smsCodeModel.countDocuments({
  ip,
  createdAt: { $gte: startOfDay }
})
if (todayCount >= 10) {
  throw new AppException(
    ExceptionCode.SMSSendFailed,
    'ä»Šæ—¥å‘é€æ¬¡æ•°å·²è¾¾ä¸Šé™'
  )
}
```

**éªŒè¯é™åˆ¶**ï¼š
```typescript
// éªŒè¯ç 5åˆ†é’Ÿæœ‰æ•ˆ
const code = await smsCodeModel.findOne({
  phone,
  type,
  code,
  isUsed: false,
  expiresAt: { $gt: new Date() }
})

// 3æ¬¡éªŒè¯å¤±è´¥åé”å®š
if (code.verifyAttempts >= 3) {
  throw new AppException(
    ExceptionCode.InvalidVerifyCode,
    'éªŒè¯ç å·²å¤±æ•ˆï¼Œè¯·é‡æ–°è·å–'
  )
}
```

---

### 9. æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ

#### 9.1 ä¸Šä¼ æ–¹å¼

**æœåŠ¡ç«¯ä¸Šä¼ **ï¼š
```typescript
// é€‚åˆå°æ–‡ä»¶
POST /api/upload/file
Content-Type: multipart/form-data

// è¿”å›
{
  url: "https://oss.example.com/files/xxx.pdf",
  objectName: "files/xxx.pdf"
}
```

**å‰ç«¯ç›´ä¼ **ï¼ˆæ¨èå¤§æ–‡ä»¶ï¼‰ï¼š
```typescript
// 1. è·å–ä¸Šä¼ å‡­è¯
GET /api/upload/credentials?dir=videos

// è¿”å›
{
  accessKeyId: "xxx",
  policy: "xxx",
  signature: "xxx",
  host: "https://bucket.oss-cn-hangzhou.aliyuncs.com",
  expire: 1234567890
}

// 2. å‰ç«¯ç›´æ¥ä¸Šä¼ åˆ°OSS
POST https://bucket.oss-cn-hangzhou.aliyuncs.com
```

#### 9.2 æ–‡ä»¶åˆ†ç±»

```
uploads/
â”œâ”€â”€ avatars/          # ç”¨æˆ·å¤´åƒ
â”œâ”€â”€ certificates/     # è¯ä¹¦å›¾ç‰‡
â”œâ”€â”€ course-covers/    # è¯¾ç¨‹å°é¢
â”œâ”€â”€ videos/           # è§†é¢‘æ–‡ä»¶
â”œâ”€â”€ pdfs/             # PDFæ–‡æ¡£
â”œâ”€â”€ proof-files/      # è¯æ˜ææ–™
â””â”€â”€ thesis/           # è®ºæ–‡æ–‡ä»¶
```

---

## ğŸ“¡ API æ¥å£è¯¦ç»†è¯´æ˜

### é€šç”¨è¯·æ±‚æ ¼å¼

#### è¯·æ±‚å¤´

```http
Content-Type: application/json
Authorization: Bearer {token}  # éœ€è¦è®¤è¯çš„æ¥å£
```

#### åˆ†é¡µå‚æ•°

```typescript
{
  page?: number    // é¡µç ï¼Œé»˜è®¤ 1
  limit?: number   // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20
}
```

#### æŸ¥è¯¢å‚æ•°

```typescript
{
  status?: string    // çŠ¶æ€ç­›é€‰
  keyword?: string   // å…³é”®è¯æœç´¢
  startTime?: Date   // å¼€å§‹æ—¶é—´
  endTime?: Date     // ç»“æŸæ—¶é—´
}
```

### é€šç”¨å“åº”æ ¼å¼

#### æˆåŠŸå“åº”

```json
{
  "code": 0,
  "message": "è¯·æ±‚æˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®
  }
}
```

#### é”™è¯¯å“åº”

```json
{
  "code": 1000,
  "message": "é”™è¯¯æè¿°",
  "data": null
}
```

#### åˆ†é¡µå“åº”

```json
{
  "code": 0,
  "message": "è¯·æ±‚æˆåŠŸ",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "limit": 20,
    "totalPages": 5
  }
}
```

### å¼‚å¸¸ä»£ç è¡¨

| ä»£ç  | è¯´æ˜ | å¸¸è§åœºæ™¯ |
|------|------|---------|
| 0 | æˆåŠŸ | - |
| 1000 | è¯·æ±‚å‚æ•°é”™è¯¯ | å‚æ•°æ ¼å¼ä¸æ­£ç¡® |
| 1001 | æœªæˆæƒ | Tokenå¤±æ•ˆæˆ–æœªç™»å½• |
| 1003 | æ— æƒé™ | è®¿é—®ä¸å±äºè‡ªå·±è§’è‰²çš„æ¥å£ |
| 1004 | èµ„æºä¸å­˜åœ¨ | IDå¯¹åº”çš„æ•°æ®ä¸å­˜åœ¨ |
| 1500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æœåŠ¡å¼‚å¸¸ |
| 2001 | ç”¨æˆ·ä¸å­˜åœ¨ | ç™»å½•æ—¶ç”¨æˆ·ä¸å­˜åœ¨ |
| 2003 | å¯†ç é”™è¯¯ | ç™»å½•å¯†ç ä¸æ­£ç¡® |
| 2004 | æ‰‹æœºå·å·²å­˜åœ¨ | æ³¨å†Œæ—¶æ‰‹æœºå·é‡å¤ |
| 2005 | éªŒè¯ç é”™è¯¯ | éªŒè¯ç ä¸æ­£ç¡®æˆ–è¿‡æœŸ |
| 4001 | æŠ¥è€ƒé¡¹ç›®ä¸å­˜åœ¨ | - |
| 4002 | å·²æäº¤è¿‡ç”³è¯· | é‡å¤æŠ¥å |
| 5001 | è¯¾ç¨‹ä¸å­˜åœ¨ | - |
| 5003 | è¯¾ç¨‹æœªè´­ä¹° | è®¿é—®æ”¶è´¹è¯¾ç¨‹å†…å®¹ |
| 6001 | è€ƒè¯•ä¸å­˜åœ¨ | - |
| 6006 | è€ƒè¯•å·²å¼€å§‹ | ä¸èƒ½é‡å¤å¼€å§‹ |
| 7001 | è®¢å•ä¸å­˜åœ¨ | - |
| 7004 | æ”¯ä»˜å¤±è´¥ | æ”¯ä»˜æ¥å£è°ƒç”¨å¤±è´¥ |

---

## ğŸ”„ æ•°æ®æµè½¬æµç¨‹

### å®Œæ•´çš„å­¦ç”Ÿå­¦ä¹ æµç¨‹ï¼ˆæ–°ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é˜¶æ®µ1ï¼šæŠ¥è€ƒç”³è¯·                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å­¦ç”Ÿæ³¨å†Œ â†’ æµè§ˆæŠ¥è€ƒé¡¹ç›® â†’ é€‰æ‹©çº§åˆ«ï¼ˆå¦‚ï¼šä¸‰çº§ï¼‰
â†’ æŸ¥çœ‹è¯¥çº§åˆ«åŒ…å«çš„è¯¾ç¨‹ï¼ˆ3é—¨ï¼‰å’Œæ€»è´¹ç”¨
â†’ å¡«å†™ä¸ªäººä¿¡æ¯ â†’ ä¸Šä¼ è¯æ˜ææ–™ â†’ æäº¤æŠ¥è€ƒç”³è¯·
â†’ ç®¡ç†å‘˜å®¡æ ¸ â†’ å®¡æ ¸é€šè¿‡ â†’ æ”¯ä»˜æŠ¥è€ƒè´¹ï¼ˆ2980å…ƒï¼‰
â†’ æŠ¥è€ƒç”Ÿæ•ˆï¼ˆ2å¹´æœ‰æ•ˆæœŸå¼€å§‹ï¼‰âœ“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é˜¶æ®µ2ï¼šè¯¾ç¨‹å­¦ä¹ ï¼ˆè¯¾ç¨‹1ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æŸ¥çœ‹çº§åˆ«è¯¾ç¨‹åˆ—è¡¨ â†’ è´­ä¹°è¯¾ç¨‹1ï¼ˆ299å…ƒï¼‰â†’ è·å¾—2æ¬¡è€ƒè¯•æœºä¼š
â†’ å­¦ä¹ è¯¾ç¨‹1ç« èŠ‚ â†’ è§‚çœ‹è§†é¢‘/ä¸‹è½½PDF â†’ è®°å½•å­¦ä¹ è¿›åº¦
â†’ å­¦ä¹ å®Œæˆ â†’ å‚åŠ è€ƒè¯•ï¼ˆç¬¬1æ¬¡ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ3ï¼šè€ƒè¯•æµç¨‹ï¼ˆé¦–è€ƒï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¼€å§‹è€ƒè¯• â†’ æ‰£é™¤1æ¬¡è€ƒè¯•æœºä¼šï¼ˆå‰©ä½™1æ¬¡ï¼‰â†’ ç”Ÿæˆè¯•å·
â†’ ç­”é¢˜ â†’ æäº¤ç­”æ¡ˆ â†’ è‡ªåŠ¨æ‰¹æ”¹å®¢è§‚é¢˜
â†’ æ•™å¸ˆè¯„åˆ†ä¸»è§‚é¢˜ï¼ˆå¦‚æœ‰ï¼‰â†’ è®¡ç®—æ€»åˆ†

    â”œâ”€â†’ é€šè¿‡ï¼ˆâ‰¥60åˆ†ï¼‰â†’ è¯¾ç¨‹1å®Œæˆ âœ“ â†’ è¿›åº¦ï¼š1/3
    â”‚
    â””â”€â†’ æœªé€šè¿‡ï¼ˆ<60åˆ†ï¼‰â†’ è¿˜æœ‰1æ¬¡è¡¥è€ƒæœºä¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ4ï¼šè¡¥è€ƒæµç¨‹ï¼ˆå¦‚éœ€è¦ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç»§ç»­å­¦ä¹  â†’ å‡†å¤‡å……åˆ† â†’ å‚åŠ è¡¥è€ƒï¼ˆç¬¬2æ¬¡ï¼‰
â†’ æ‰£é™¤1æ¬¡è€ƒè¯•æœºä¼šï¼ˆå‰©ä½™0æ¬¡ï¼‰â†’ ç­”é¢˜æäº¤

    â”œâ”€â†’ é€šè¿‡ â†’ è¯¾ç¨‹1å®Œæˆ âœ“ â†’ è¿›åº¦ï¼š1/3
    â”‚
    â””â”€â†’ æœªé€šè¿‡ â†’ è€ƒè¯•æ¬¡æ•°ç”¨å®Œ â†’ éœ€è¦é‡æ–°è´­ä¹°è¯¾ç¨‹1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é˜¶æ®µ5ï¼šé‡æ–°è´­ä¹°ï¼ˆå¦‚2æ¬¡éƒ½æœªé€šè¿‡ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é‡æ–°è´­ä¹°è¯¾ç¨‹1ï¼ˆ299å…ƒï¼‰â†’ åˆ›å»ºæ–°çš„è´­ä¹°è®°å½•
â†’ é‡æ–°è·å¾—2æ¬¡è€ƒè¯•æœºä¼š â†’ ç»§ç»­å­¦ä¹ å’Œè€ƒè¯•
â†’ ç›´åˆ°é€šè¿‡ä¸ºæ­¢

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ6ï¼šå®Œæˆå…¶ä»–è¯¾ç¨‹ï¼ˆè¯¾ç¨‹2ã€è¯¾ç¨‹3ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
è¯¾ç¨‹1é€šè¿‡å â†’ è´­ä¹°è¯¾ç¨‹2ï¼ˆ399å…ƒï¼‰â†’ å­¦ä¹  â†’ è€ƒè¯•ï¼ˆæœ€å¤š2æ¬¡ï¼‰
â†’ é€šè¿‡ â†’ è¿›åº¦ï¼š2/3
â†’ è´­ä¹°è¯¾ç¨‹3ï¼ˆ399å…ƒï¼‰â†’ å­¦ä¹  â†’ è€ƒè¯•ï¼ˆæœ€å¤š2æ¬¡ï¼‰
â†’ é€šè¿‡ â†’ è¿›åº¦ï¼š3/3 âœ“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ7ï¼šè¯ä¹¦ç”³è¯·                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ£€æŸ¥æ¡ä»¶ï¼š
  âœ“ æ‰€æœ‰è¯¾ç¨‹ï¼ˆ3é—¨ï¼‰è€ƒè¯•éƒ½é€šè¿‡
  âœ“ æŠ¥è€ƒåœ¨2å¹´æœ‰æ•ˆæœŸå†…
    â†“
æ»¡è¶³æ¡ä»¶ â†’ ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆç”µå­è¯ä¹¦ âœ“
â†’ å­¦ç”Ÿç”³è¯·çº¸è´¨è¯ä¹¦é‚®å¯„ï¼ˆå¯é€‰ï¼‰
â†’ ç®¡ç†å‘˜åˆ›å»ºç‰©æµè®°å½• â†’ è¯ä¹¦å‘è´§
â†’ å­¦ç”Ÿæ”¶åˆ°çº¸è´¨è¯ä¹¦ â†’ å–è¯å®Œæˆ âœ“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç‰¹æ®Šæƒ…å†µï¼šæŠ¥è€ƒè¿‡æœŸ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¦‚æœ2å¹´å†…æœªå®Œæˆæ‰€æœ‰è¯¾ç¨‹è€ƒè¯•ï¼š
  â†’ æŠ¥è€ƒè‡ªåŠ¨å¤±æ•ˆï¼ˆstatus = 'expired'ï¼‰
  â†’ æ‰€æœ‰è¯¾ç¨‹è´­ä¹°è®°å½•å¤±æ•ˆ
  â†’ æ‰€æœ‰è€ƒè¯•æˆç»©ä½œåºŸ
  â†’ éœ€è¦é‡æ–°æŠ¥è€ƒï¼ˆé‡æ–°æ”¯ä»˜æŠ¥è€ƒè´¹ï¼‰
  â†’ éœ€è¦é‡æ–°è´­ä¹°æ‰€æœ‰è¯¾ç¨‹
```

### æ—¶é—´çº¿ç¤ºä¾‹

å‡è®¾å­¦ç”Ÿå¼ ä¸‰æŠ¥è€ƒ"é£é™©ç®¡ç†å¸ˆä¸‰çº§"ï¼š

**2023å¹´6æœˆ15æ—¥**ï¼š
- æäº¤æŠ¥è€ƒç”³è¯· â†’ å®¡æ ¸é€šè¿‡ â†’ æ”¯ä»˜æŠ¥è€ƒè´¹2980å…ƒ
- æŠ¥è€ƒç”Ÿæ•ˆï¼Œæœ‰æ•ˆæœŸè‡³ **2025å¹´6æœˆ15æ—¥**ï¼ˆ2å¹´ï¼‰

**2023å¹´7æœˆ**ï¼š
- è´­ä¹°è¯¾ç¨‹1ï¼ˆ299å…ƒï¼‰â†’ å­¦ä¹ 1ä¸ªæœˆ â†’ è€ƒè¯•é€šè¿‡ âœ“ï¼ˆè¿›åº¦ï¼š1/3ï¼‰

**2023å¹´9æœˆ**ï¼š
- è´­ä¹°è¯¾ç¨‹2ï¼ˆ399å…ƒï¼‰â†’ å­¦ä¹  â†’ é¦–è€ƒæœªé€šè¿‡ â†’ è¡¥è€ƒé€šè¿‡ âœ“ï¼ˆè¿›åº¦ï¼š2/3ï¼‰

**2023å¹´11æœˆ**ï¼š
- è´­ä¹°è¯¾ç¨‹3ï¼ˆ399å…ƒï¼‰â†’ å­¦ä¹  â†’ 2æ¬¡è€ƒè¯•éƒ½æœªé€šè¿‡ âœ—
- é‡æ–°è´­ä¹°è¯¾ç¨‹3ï¼ˆ399å…ƒï¼‰â†’ å†æ¬¡å­¦ä¹ 

**2024å¹´1æœˆ**ï¼š
- è¯¾ç¨‹3è€ƒè¯•é€šè¿‡ âœ“ï¼ˆè¿›åº¦ï¼š3/3ï¼‰
- æ‰€æœ‰è¯¾ç¨‹å®Œæˆï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ âœ“
- ç”³è¯·çº¸è´¨è¯ä¹¦é‚®å¯„

**æ€»è´¹ç”¨**ï¼š2980ï¼ˆæŠ¥è€ƒï¼‰+ 299ï¼ˆè¯¾ç¨‹1ï¼‰+ 399ï¼ˆè¯¾ç¨‹2ï¼‰+ 399Ã—2ï¼ˆè¯¾ç¨‹3è´­ä¹°2æ¬¡ï¼‰= **4476å…ƒ**

**æ€»è€—æ—¶**ï¼šçº¦7ä¸ªæœˆï¼ˆåœ¨2å¹´æœ‰æ•ˆæœŸå†…ï¼‰

### å¤±è´¥æ¡ˆä¾‹ç¤ºä¾‹

å‡è®¾å­¦ç”Ÿæå››ï¼š

**2023å¹´6æœˆ15æ—¥**ï¼šæŠ¥è€ƒç”Ÿæ•ˆï¼Œæœ‰æ•ˆæœŸè‡³ 2025å¹´6æœˆ15æ—¥

**2023-2024å¹´**ï¼š
- å®Œæˆè¯¾ç¨‹1å’Œè¯¾ç¨‹2 âœ“ï¼ˆè¿›åº¦ï¼š2/3ï¼‰
- è¯¾ç¨‹3ä¸€ç›´æœªè´­ä¹°æˆ–æœªé€šè¿‡

**2025å¹´6æœˆ16æ—¥**ï¼š
- æŠ¥è€ƒè¿‡æœŸ âœ—
- è¯¾ç¨‹1å’Œè¯¾ç¨‹2çš„æˆç»©ä½œåºŸ
- æ‰€æœ‰è¯¾ç¨‹è´­ä¹°æƒé™å¤±æ•ˆ
- éœ€è¦é‡æ–°æŠ¥è€ƒï¼ˆé‡æ–°æ”¯ä»˜2980å…ƒæŠ¥è€ƒè´¹ï¼‰
- éœ€è¦é‡æ–°è´­ä¹°å’Œå­¦ä¹ æ‰€æœ‰è¯¾ç¨‹

---

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. è®¤è¯æœºåˆ¶

**JWT Token**ï¼š
```typescript
{
  sub: userId,           // ç”¨æˆ·ID
  phone: string,         // æ‰‹æœºå·
  role: UserRole,        // è§’è‰²
  iat: number,          // ç­¾å‘æ—¶é—´
  exp: number,          // è¿‡æœŸæ—¶é—´
}
```

**Token ä½¿ç”¨**ï¼š
```http
GET /api/student/course/my-courses
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 2. å¯†ç å®‰å…¨

```typescript
// ä½¿ç”¨ bcrypt åŠ å¯†
const salt = await bcrypt.genSalt(10)
const hashedPassword = await bcrypt.hash(password, salt)

// éªŒè¯
const isValid = await bcrypt.compare(inputPassword, user.password)
```

### 3. æ•°æ®è„±æ•

æ•æ„Ÿä¿¡æ¯è¿”å›æ—¶è„±æ•ï¼š
```typescript
{
  name: "å¼ ä¸‰",
  phone: "138****8000",      // æ‰‹æœºå·è„±æ•
  idCard: "110***********1234" // èº«ä»½è¯è„±æ•
}
```

### 4. SQL/NoSQL æ³¨å…¥é˜²æŠ¤

- ä½¿ç”¨ Mongoose ODMï¼Œè‡ªåŠ¨é˜²æ­¢æ³¨å…¥
- å‚æ•°éªŒè¯ä½¿ç”¨ class-validator
- ObjectId æ ¼å¼éªŒè¯

### 5. XSS é˜²æŠ¤

- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- HTML å†…å®¹è½¬ä¹‰
- CSP å¤´éƒ¨è®¾ç½®

### 6. CORS é…ç½®

```typescript
app.enableCors({
  origin: process.env.ALLOWED_ORIGINS?.split(','),
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],
})
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å­¦ç”Ÿæ³¨å†Œå¹¶ç™»å½•

```bash
# 1. å‘é€éªŒè¯ç 
curl -X POST http://localhost:3000/api/student/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "type": "register"
  }'

# 2. æ³¨å†Œ
curl -X POST http://localhost:3000/api/student/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "password123",
    "name": "å¼ ä¸‰",
    "verifyCode": "123456"
  }'

# 3. ç™»å½•è·å– Token
curl -X POST http://localhost:3000/api/student/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "password": "password123"
  }'
```

### ç¤ºä¾‹ 2: åˆ›å»ºæ”¶è´¹è¯¾ç¨‹ï¼ˆç®¡ç†ç«¯ï¼‰

```bash
# åˆ›å»ºè¯¾ç¨‹
curl -X POST http://localhost:3000/api/admin/course/courses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {admin_token}" \
  -d '{
    "name": "é«˜çº§é£é™©ç®¡ç†è¯¾ç¨‹",
    "description": "æ·±å…¥å­¦ä¹ é£é™©ç®¡ç†ç†è®ºä¸å®è·µ",
    "coverUrl": "https://oss.example.com/covers/course1.jpg",
    "isFree": false,
    "price": 299,
    "projectId": "60d0fe4f5e3a6b001c8e3a1a",
    "instructorId": "60d0fe4f5e3a6b001c8e3a1b",
    "instructorName": "ææ•™æˆ",
    "direction": "é£é™©ç®¡ç†",
    "hasExam": true,
    "status": "active"
  }'
```

### ç¤ºä¾‹ 3: åˆ›å»ºç« èŠ‚ï¼ˆç®¡ç†ç«¯ï¼‰

```bash
# åˆ›å»ºè§†é¢‘ç« èŠ‚
curl -X POST http://localhost:3000/api/admin/course/lessons \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {admin_token}" \
  -d '{
    "courseId": "60d0fe4f5e3a6b001c8e3a1c",
    "title": "ç¬¬ä¸€ç« ï¼šé£é™©è¯†åˆ«æ–¹æ³•",
    "order": 1,
    "contentType": "video",
    "mediaUrl": "https://oss.example.com/videos/chapter1.mp4",
    "videoUrl": "https://oss.example.com/videos/chapter1.mp4",
    "pdfUrl": "https://oss.example.com/pdfs/chapter1-notes.pdf",
    "description": "æœ¬ç« ä»‹ç»å¸¸è§çš„é£é™©è¯†åˆ«æ–¹æ³•",
    "content": "é£é™©è¯†åˆ«æ˜¯é£é™©ç®¡ç†çš„ç¬¬ä¸€æ­¥...",
    "durationInSeconds": 1800,
    "status": "active"
  }'
```

### ç¤ºä¾‹ 4: å­¦ç”ŸæŸ¥çœ‹è¯¾ç¨‹ç« èŠ‚

```bash
# æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…ï¼ˆåŒ…å«è´­ä¹°çŠ¶æ€ï¼‰
curl -X GET http://localhost:3000/api/student/course/courses/60d0fe4f5e3a6b001c8e3a1c \
  -H "Authorization: Bearer {student_token}"

# å“åº”ç¤ºä¾‹ï¼ˆæœªè´­ä¹°ï¼‰
{
  "code": 0,
  "data": {
    "_id": "60d0fe4f5e3a6b001c8e3a1c",
    "name": "é«˜çº§é£é™©ç®¡ç†è¯¾ç¨‹",
    "isFree": false,
    "price": 299,
    "hasPurchased": false,
    "canAccess": false
  }
}

# æŸ¥çœ‹ç« èŠ‚åˆ—è¡¨ï¼ˆæœªè´­ä¹°æ—¶éšè—å†…å®¹ï¼‰
curl -X GET http://localhost:3000/api/student/course/courses/60d0fe4f5e3a6b001c8e3a1c/lessons \
  -H "Authorization: Bearer {student_token}"

# å“åº”ç¤ºä¾‹ï¼ˆæœªè´­ä¹°ï¼‰
{
  "code": 0,
  "data": [
    {
      "_id": "xxx",
      "title": "ç¬¬ä¸€ç« ï¼šé£é™©è¯†åˆ«æ–¹æ³•",
      "order": 1,
      "description": "æœ¬ç« ä»‹ç»å¸¸è§çš„é£é™©è¯†åˆ«æ–¹æ³•",
      "contentType": "video",
      "durationInSeconds": 1800,
      "canAccess": false,
      "message": "è¯¥è¯¾ç¨‹ä¸ºæ”¶è´¹è¯¾ç¨‹ï¼Œè¯·è´­ä¹°åæŸ¥çœ‹ç« èŠ‚å†…å®¹"
    }
  ]
}
```

### ç¤ºä¾‹ 5: è´­ä¹°è¯¾ç¨‹åæŸ¥çœ‹å†…å®¹

```bash
# è´­ä¹°è¯¾ç¨‹ï¼ˆåˆ›å»ºè®¢å•å¹¶æ”¯ä»˜ï¼‰
# ... æ”¯ä»˜æˆåŠŸå ...

# å†æ¬¡æŸ¥çœ‹ç« èŠ‚è¯¦æƒ…ï¼ˆå·²è´­ä¹°ï¼‰
curl -X GET http://localhost:3000/api/student/course/lessons/xxx \
  -H "Authorization: Bearer {student_token}"

# å“åº”ç¤ºä¾‹ï¼ˆå·²è´­ä¹°ï¼‰
{
  "code": 0,
  "data": {
    "_id": "xxx",
    "title": "ç¬¬ä¸€ç« ï¼šé£é™©è¯†åˆ«æ–¹æ³•",
    "contentType": "video",
    "mediaUrl": "https://oss.example.com/videos/chapter1.mp4",
    "videoUrl": "https://oss.example.com/videos/chapter1.mp4",
    "pdfUrl": "https://oss.example.com/pdfs/chapter1-notes.pdf",
    "description": "æœ¬ç« ä»‹ç»å¸¸è§çš„é£é™©è¯†åˆ«æ–¹æ³•",
    "content": "é£é™©è¯†åˆ«æ˜¯é£é™©ç®¡ç†çš„ç¬¬ä¸€æ­¥...",
    "durationInSeconds": 1800,
    "canAccess": true
  }
}
```

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm run test

# ç›‘å¬æ¨¡å¼
pnpm run test:watch

# æµ‹è¯•è¦†ç›–ç‡
pnpm run test:cov
```

### E2E æµ‹è¯•

```bash
pnpm run test:e2e
```

### API æµ‹è¯•

ä½¿ç”¨ Swagger UI åœ¨çº¿æµ‹è¯•ï¼š
1. è®¿é—® http://localhost:3000/docs
2. ç‚¹å‡»æ¥å£å±•å¼€
3. ç‚¹å‡» "Try it out"
4. å¡«å…¥å‚æ•°
5. ç‚¹å‡» "Execute"

---

## ğŸ“± å®¢æˆ·ç«¯é›†æˆ

### è¯·æ±‚æ‹¦æˆªå™¨é…ç½®

```typescript
// axios é…ç½®ç¤ºä¾‹
import axios from 'axios'

const api = axios.create({
  baseURL: 'http://localhost:3000/api',
  timeout: 30000,
})

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  response => {
    const { code, data, message } = response.data
    if (code === 0) {
      return data
    } else {
      return Promise.reject(new Error(message))
    }
  },
  error => {
    // å¤„ç† HTTP é”™è¯¯
    return Promise.reject(error)
  }
)
```

### TypeScript ç±»å‹å®šä¹‰

```typescript
// ç”¨æˆ·æ¥å£
interface User {
  _id: string
  phone: string
  name: string
  role: 'admin' | 'teacher' | 'student'
  status: 'active' | 'inactive'
}

// è¯¾ç¨‹æ¥å£
interface Course {
  _id: string
  name: string
  description: string
  coverUrl: string
  isFree: boolean
  price: number
  instructorName: string
  lessonCount: number
  totalDuration: number
  status: 'active' | 'inactive'
  hasPurchased?: boolean
  canAccess?: boolean
}

// ç« èŠ‚æ¥å£
interface Lesson {
  _id: string
  courseId: string
  title: string
  order: number
  contentType: 'video' | 'pdf' | 'ppt'
  mediaUrl: string | null
  videoUrl?: string | null
  pdfUrl?: string | null
  description: string
  content?: string
  durationInSeconds: number
  canAccess: boolean
  message?: string
}
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

**æ£€æŸ¥é¡¹**ï¼š
- [ ] MongoDB æœåŠ¡æ˜¯å¦è¿è¡Œ
- [ ] Redis æœåŠ¡æ˜¯å¦è¿è¡Œï¼ˆå¦‚é…ç½®ï¼‰
- [ ] é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
- [ ] ç«¯å£æ˜¯å¦è¢«å ç”¨
- [ ] Node.js ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚

**æ—¥å¿—æŸ¥çœ‹**ï¼š
```bash
# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
pm2 logs --lines 100

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
pm2 logs --lines 0
```

### 2. ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯

**é˜¿é‡Œäº‘æœåŠ¡åˆå§‹åŒ–å¤±è´¥**ï¼š
- æ£€æŸ¥ AccessKey é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²å¼€é€š
- æŸ¥çœ‹é˜¿é‡Œäº‘æ§åˆ¶å°ä½™é¢

**æ”¯ä»˜å›è°ƒæœªæ”¶åˆ°**ï¼š
- æ£€æŸ¥å›è°ƒåœ°å€æ˜¯å¦å¯ä»¥å…¬ç½‘è®¿é—®
- æŸ¥çœ‹æ”¯ä»˜å¹³å°çš„é€šçŸ¥æ—¥å¿—
- éªŒè¯ç­¾åæ˜¯å¦æ­£ç¡®

### 3. æ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# æµ‹è¯• MongoDB è¿æ¥
mongo mongodb://localhost:27017/yuan_teaching_dev

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
use yuan_teaching_dev
db.stats()
```

### 4. æƒé™é—®é¢˜

**å­¦ç”Ÿæ— æ³•è®¿é—®ç« èŠ‚å†…å®¹**ï¼š
1. æ£€æŸ¥è¯¾ç¨‹æ˜¯å¦ä¸ºæ”¶è´¹è¯¾ç¨‹
2. æ£€æŸ¥æ˜¯å¦æœ‰è´­ä¹°è®°å½•
3. æ£€æŸ¥è´­ä¹°è®°å½•çŠ¶æ€æ˜¯å¦ä¸º active

**æ•™å¸ˆæ— æ³•å‘å¸ƒå¾®è¯¾å ‚**ï¼š
1. æ£€æŸ¥æ•™å¸ˆèµ„è´¨æ˜¯å¦å·²å®¡æ ¸é€šè¿‡
2. æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆ
3. æ£€æŸ¥è§’è‰²æƒé™é…ç½®

---

## ğŸ® ç®¡ç†åå°æ“ä½œæ‰‹å†Œ

### åˆå§‹åŒ–ç³»ç»Ÿ

#### 1. åˆ›å»ºè¶…çº§ç®¡ç†å‘˜

```bash
# é¦–æ¬¡éƒ¨ç½²éœ€è¦æ‰‹åŠ¨åˆ›å»º
POST /api/admin/users/create-admin
{
  "phone": "13800138000",
  "password": "Admin@123456",
  "name": "è¶…çº§ç®¡ç†å‘˜"
}
```

#### 2. åˆ›å»ºæŠ¥è€ƒé¡¹ç›®

```bash
POST /api/admin/enroll/projects
{
  "name": "é£é™©ç®¡ç†å¸ˆèŒä¸šèµ„æ ¼è®¤è¯",
  "description": "å›½å®¶è®¤å¯çš„é£é™©ç®¡ç†å¸ˆèµ„æ ¼è¯ä¹¦",
  "levels": [
    {
      "level": "ä¸‰çº§",
      "price": 2980,
      "requirements": "å¤§ä¸“åŠä»¥ä¸Šå­¦å†",
      "description": "é€‚åˆé£é™©ç®¡ç†åˆå­¦è€…"
    },
    {
      "level": "äºŒçº§",
      "price": 3980,
      "requirements": "æœ¬ç§‘åŠä»¥ä¸Šå­¦å†ï¼Œ2å¹´å·¥ä½œç»éªŒ",
      "description": "é€‚åˆæœ‰ä¸€å®šç»éªŒçš„ä»ä¸šè€…"
    }
  ],
  "registrationStartDate": "2025-01-01",
  "registrationEndDate": "2025-03-31",
  "examDate": "2025-06-15",
  "status": "active"
}
```

#### 3. åˆ›å»ºè¯¾ç¨‹ä½“ç³»

```bash
# åˆ›å»ºè¯¾ç¨‹
POST /api/admin/course/courses
{
  "name": "é£é™©ç®¡ç†åŸºç¡€ç†è®º",
  "projectId": "xxx",
  "isFree": false,
  "price": 299
}

# æ·»åŠ ç« èŠ‚
POST /api/admin/course/lessons
{
  "courseId": "xxx",
  "title": "ç¬¬ä¸€ç« ï¼šé£é™©çš„æ¦‚å¿µ",
  "order": 1,
  "contentType": "video",
  "videoUrl": "https://oss.../video1.mp4",
  "pdfUrl": "https://oss.../notes1.pdf",
  "description": "ä»‹ç»é£é™©çš„åŸºæœ¬æ¦‚å¿µå’Œåˆ†ç±»"
}
```

#### 4. åˆ›å»ºé¢˜åº“å’Œè€ƒè¯•

```bash
# åˆ›å»ºé¢˜åº“
POST /api/admin/question-bank/banks
{
  "name": "é£é™©ç®¡ç†ä¸‰çº§é¢˜åº“",
  "courseId": "xxx",
  "description": "åŒ…å«å…¨éƒ¨è€ƒè¯•èŒƒå›´"
}

# æ·»åŠ é¢˜ç›®
POST /api/admin/question-bank/banks/{bankId}/questions
{
  "type": "single_choice",
  "content": "é£é™©ç®¡ç†çš„é¦–è¦æ­¥éª¤æ˜¯ï¼Ÿ",
  "options": [
    "A. é£é™©è¯†åˆ«",
    "B. é£é™©è¯„ä¼°",
    "C. é£é™©æ§åˆ¶",
    "D. é£é™©ç›‘æ§"
  ],
  "answer": "A",
  "score": 2,
  "difficulty": 2
}

# é…ç½®è€ƒè¯•
POST /api/admin/exam/configs
{
  "projectId": "xxx",
  "courseId": "xxx",
  "questionBankId": "xxx",
  "examName": "é£é™©ç®¡ç†ä¸‰çº§è€ƒè¯•",
  "duration": 120,
  "totalScore": 100,
  "passScore": 60,
  "questionConfig": {
    "single_choice": { "count": 30, "score": 2 },
    "multiple_choice": { "count": 10, "score": 3 },
    "true_false": { "count": 10, "score": 1 },
    "short_answer": { "count": 5, "score": 8 }
  }
}
```

### æ—¥å¸¸è¿è¥æ“ä½œ

#### å®¡æ ¸æŠ¥è€ƒç”³è¯·

```bash
# 1. æŸ¥çœ‹å¾…å®¡æ ¸åˆ—è¡¨
GET /api/admin/enroll/applications?status=pending

# 2. æŸ¥çœ‹ç”³è¯·è¯¦æƒ…
GET /api/admin/enroll/applications/{id}

# 3. å®¡æ ¸é€šè¿‡
POST /api/admin/enroll/applications/{id}/review
{
  "status": "approved",
  "remark": "èµ„æ–™é½å…¨ï¼Œå®¡æ ¸é€šè¿‡"
}

# 4. å®¡æ ¸æ‹’ç»
POST /api/admin/enroll/applications/{id}/review
{
  "status": "rejected",
  "remark": "å­¦å†è¯æ˜ä¸æ¸…æ™°ï¼Œè¯·é‡æ–°ä¸Šä¼ "
}
```

#### ç”Ÿæˆè¯ä¹¦

```bash
# å­¦ç”Ÿè€ƒè¯•é€šè¿‡åï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆç”µå­è¯ä¹¦
# æˆ–ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»º
POST /api/admin/certificates
{
  "userId": "xxx",
  "projectId": "xxx",
  "examSessionId": "xxx",
  "type": "èŒä¸šèµ„æ ¼è¯ä¹¦",
  "name": "é£é™©ç®¡ç†å¸ˆä¸‰çº§",
  "level": "ä¸‰çº§",
  "holderInfo": {
    "name": "å¼ ä¸‰",
    "idCard": "110***********1234",
    "photo": "https://oss.../photo.jpg"
  },
  "needPhysical": true
}
```

#### é…é€çº¸è´¨è¯ä¹¦

```bash
# åˆ›å»ºç‰©æµè®°å½•
POST /api/admin/logistics
{
  "userId": "xxx",
  "certificateId": "xxx",
  "courier": "é¡ºä¸°é€Ÿè¿",
  "trackingNo": "SF1234567890",
  "shippingAddress": {
    "receiverName": "å¼ ä¸‰",
    "receiverPhone": "13800138000",
    "province": "åŒ—äº¬å¸‚",
    "city": "åŒ—äº¬å¸‚",
    "district": "æœé˜³åŒº",
    "address": "æŸæŸè¡—é“123å·"
  }
}

# æ›´æ–°ç‰©æµè½¨è¿¹
POST /api/admin/logistics/{id}/tracking
{
  "status": "è¿è¾“ä¸­",
  "description": "å¿«ä»¶å·²å‘å‡º",
  "location": "åŒ—äº¬åˆ†æ‹¨ä¸­å¿ƒ"
}
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡ä¸æŠ¥è¡¨

### å¯ç”¨çš„ç»Ÿè®¡æ¥å£

**æ•™å¸ˆç»Ÿè®¡**ï¼š
```bash
# å¾®è¯¾å ‚æœˆåº¦ç»Ÿè®¡
GET /api/teacher/micro-courses/stats/monthly?year=2025&month=11
```

**ç®¡ç†ç«¯ç»Ÿè®¡**ï¼ˆå¯æ‰©å±•ï¼‰ï¼š
- æŠ¥åäººæ•°ç»Ÿè®¡
- è¯¾ç¨‹é”€å”®ç»Ÿè®¡
- è€ƒè¯•é€šè¿‡ç‡ç»Ÿè®¡
- è¯ä¹¦å‘æ”¾ç»Ÿè®¡
- æ”¶å…¥ç»Ÿè®¡

---

## ğŸš€ æ€§èƒ½åŸºå‡†

### å“åº”æ—¶é—´

- API å¹³å‡å“åº”æ—¶é—´ï¼š< 100ms
- æ•°æ®åº“æŸ¥è¯¢ï¼š< 50ms
- æ–‡ä»¶ä¸Šä¼ ï¼šæ ¹æ®æ–‡ä»¶å¤§å°ï¼Œ1MB < 1s

### å¹¶å‘èƒ½åŠ›

- å•å®ä¾‹æ”¯æŒï¼š1000+ å¹¶å‘è¯·æ±‚
- é›†ç¾¤æ¨¡å¼ï¼šå¯æ°´å¹³æ‰©å±•

### èµ„æºå ç”¨

- å†…å­˜å ç”¨ï¼šçº¦ 200-500MB
- CPU å ç”¨ï¼š< 10%ï¼ˆç©ºé—²ï¼‰ã€< 50%ï¼ˆé«˜å³°ï¼‰

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†

- å¼€å‘ç¯å¢ƒä½¿ç”¨ `dev.config.js`
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `prod.config.js`
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- ä¸è¦æäº¤åŒ…å«å¯†é’¥çš„é…ç½®æ–‡ä»¶åˆ° Git

### 2. é”™è¯¯å¤„ç†

```typescript
try {
  const result = await someAsyncOperation()
  return result
} catch (error) {
  this.logger.error(`æ“ä½œå¤±è´¥: ${error.message}`, error.stack)
  throw new AppException(
    ExceptionCode.InternalServerError,
    'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
  )
}
```

### 3. æ•°æ®éªŒè¯

- æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½è¦éªŒè¯
- ä½¿ç”¨ DTO + class-validator
- ObjectId æ ¼å¼éªŒè¯
- ä¸šåŠ¡è§„åˆ™éªŒè¯

### 4. æ—¥å¿—è®°å½•

```typescript
// é‡è¦æ“ä½œè®°å½•æ—¥å¿—
this.logger.log(`ç”¨æˆ· ${userId} è´­ä¹°äº†è¯¾ç¨‹ ${courseId}`)
this.logger.warn(`è®¢å• ${orderId} æ”¯ä»˜è¶…æ—¶`)
this.logger.error(`æ”¯ä»˜å›è°ƒéªŒè¯å¤±è´¥: ${error.message}`)
```

---

## ğŸŒŸ æœªæ¥è§„åˆ’

### å¾…å¼€å‘åŠŸèƒ½

- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆExcelã€CSVï¼‰
- [ ] æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡å¯¼å…¥ã€æ‰¹é‡å®¡æ ¸ï¼‰
- [ ] æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿï¼ˆç«™å†…ä¿¡ã€é‚®ä»¶ã€çŸ­ä¿¡ï¼‰
- [ ] æ•°æ®ç»Ÿè®¡æŠ¥è¡¨ï¼ˆå¯è§†åŒ–å›¾è¡¨ï¼‰
- [ ] æ“ä½œæ—¥å¿—å®¡è®¡
- [ ] å­¦ä¹ ç¤¾åŒºï¼ˆè®¨è®ºåŒºã€é—®ç­”ï¼‰
- [ ] ç›´æ’­è¯¾ç¨‹æ”¯æŒ
- [ ] AI è¾…åŠ©è¯„åˆ†
- [ ] å­¦ä¹ è·¯å¾„æ¨è
- [ ] ç§»åŠ¨ç«¯ APP API

---

## ğŸ‰ æ€»ç»“

è‚²å®‰æ•™è‚²ç®¡ç†å¹³å°åç«¯æœåŠ¡æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°ã€æ˜“äºæ‰©å±•çš„åœ¨çº¿æ•™è‚²ç®¡ç†ç³»ç»Ÿã€‚

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **å®Œæ•´çš„ä¸šåŠ¡é—­ç¯** - ä»æŠ¥ååˆ°è¯ä¹¦å‘æ”¾çš„å®Œæ•´æµç¨‹  
âœ… **çµæ´»çš„è¯¾ç¨‹ä½“ç³»** - æ”¯æŒå…è´¹/æ”¶è´¹ã€è§†é¢‘/PDFç­‰å¤šç§å½¢å¼  
âœ… **ä¸¥æ ¼çš„æƒé™æ§åˆ¶** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨  
âœ… **ä¸°å¯Œçš„é›†æˆæœåŠ¡** - æ”¯ä»˜ã€çŸ­ä¿¡ã€å­˜å‚¨ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡  
âœ… **ä¼˜ç§€çš„ä»£ç è´¨é‡** - TypeScriptã€ESLintã€ç»Ÿä¸€è§„èŒƒ  
âœ… **å®Œå–„çš„æ–‡æ¡£** - Swagger è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£  

### é€‚ç”¨åœºæ™¯

- ğŸ“ èŒä¸šèµ„æ ¼åŸ¹è®­æœºæ„
- ğŸ“š åœ¨çº¿æ•™è‚²å¹³å°
- ğŸ« ä¼ä¸šåŸ¹è®­ç³»ç»Ÿ
- ğŸ“– çŸ¥è¯†ä»˜è´¹å¹³å°
- ğŸ¯ æŠ€èƒ½è®¤è¯ç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-29  
**ç»´æŠ¤å›¢é˜Ÿ**: Yuan Teaching Team

